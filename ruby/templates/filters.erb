<html>
<head>
  <style>
    body {background: black}
    .page {margin-left: auto; margin-right: auto; width: 890px}
    .container {background: grey; width: 800px; min-height: 200px}
    .frame1 {padding: 20px; border: 5px solid cyan}
    .frame2 {padding: 20px; margin-top: 10px; position: relative}
    .title {position: absolute; top: 15px; left: 45px; display: flex; width: 800px}
    .title div {background: cyan; border-top: 5px solid black; border-bottom: 5px solid black;
      flex-grow: 1; height: 5px}
    .title span {font-size: 20px; color: cyan; background: black; position: relative; top: -5px; left: 0px;
      padding-left: 10px; padding-right: 10px}
    .button {display: inline-block; border: 1px solid black; border-radius: 5px; background: cyan; font-size: 24px;
      margin: 5px; padding: 2px}
    .menu {margin-left: auto; margin-right: auto; color: white; font-size: 30px; margin-bottom: 10px}
    .menu a {color: cyan}
    .menu td {padding: 10px}
    .blurb {margin-left: auto; margin-right: auto; color: cyan; font-size: 20px; max-width: 750px}
  </style>
  <script>
      function drag(ev,index) {
          ev.dataTransfer.setData("index", index);
      }
      function drop(ev) {
          ev.preventDefault();
          var index = ev.dataTransfer.getData("index");
          var flag = '';
          var className = ev.target.className;
          if ( className.includes( "include") ) {
              flag = "Y";
          }
          if ( className.includes( "exclude") ) {
              flag = "N";
          }
          window.localStorage.setItem( "pagoda.aspect." + index, flag);
          refresh();
      }
      function make_button( name, index, status) {
          return '<div class="button ' + status + '"' +
              ' draggable="true"' +
              ' ondragstart="drag( event, ' + index + ')"' +
              ' ondragover="event.preventDefault()"' +
              ' ondrop="drop(event)">' +name + '</div>';
      }

      function add_button( name, index, contents) {
          var flag = window.localStorage.getItem( "pagoda.aspect." + index);
          var status = 'ignore';
          if (flag == 'Y') {status = 'include';}
          if (flag == 'N') {status = 'exclude';}
          button = make_button( name, index, status);
          if (flag == 'Y') {
              contents.included = contents.included + button;
          }
          else if (flag == 'N') {
              contents.excluded = contents.excluded + button;
          }
          else {
              contents.unused = contents.unused + button;
          }
      }

      function refresh() {
          const contents = {excluded:'', included:'', unused: ''};
          <% aspects.each_pair do |n,info| %>
            add_button( '<%= n %>', <%= info['index'] %>, contents);
          <% end %>
          var excluded_box = document.getElementById( "exclude");
          excluded_box.innerHTML = contents.excluded;
          var included_box = document.getElementById( "include");
          included_box.innerHTML = contents.included;
          var unused_box = document.getElementById( "unused");
          unused_box.innerHTML = contents.unused;
      }
  </script>
</head>
<body>
<div class="page">
  <table class="menu">
    <tr>
      <td><a href="games.html">Games</a></td>
      <td>Filters</td>
      <td><a href="aspects.html">Aspects</a></td>
    </tr>
  </table>
  <div class="blurb">
    The aspects can be dragged and dropped between the different
    buckets. Aspects in the Include bucket will limit games displayed
    to those with those aspects. Aspects in the Exclude bucket will limit
    games to those without those aspects. The game data will not be
    perfect so don't use it for mission critical purposes
    like nuclear power stations etc.
  </div>
  <% containers.each do |name| %>
    <div class="frame2">
      <div class="frame1">
        <div id="<%= name %>" class="container <%= name %>"
             ondragover="event.preventDefault()" ondrop="drop(event)"></div>
      </div>
      <div class="title"><div></div><span><%= name.capitalize %></span><div></div></div>
    </div>
  <% end %>
  <script>
      refresh();
  </script>
</div>
</body>
</html>
