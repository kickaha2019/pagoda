<%= erb :header, :locals => {:page => 'scan'} %>

<table class="search">
  <tr>
    <td>
      <label for="search">Search:</label>
      <input type="text" id="search" maxlength="40" oninput="search_input()">
    </td>
    <td><div id="pages"></div></td>
  </tr>
</table>

<table class=combos">
  <tr>
    <%=
      html = []
      @chosen_site   = scan_site_combo( 'site',   html)
      @chosen_type   = scan_type_combo( 'type',   @chosen_site, html)
      @chosen_status = scan_status_combo( 'status', @chosen_site, @chosen_type, html)
      html.join( "\n")
    %>
  </tr>
</table>

<div id="list"></div>

<script>
    function load_scan() {
        var xhttp = new XMLHttpRequest();
        xhttp.open("GET", "/scan_list", false);
        xhttp.send();
        document.getElementById("list").innerHTML = xhttp.responseText;

        xhttp = new XMLHttpRequest();
        xhttp.open("GET", "/page_control/scan", false);
        xhttp.send();
        document.getElementById("pages").innerHTML = xhttp.responseText;
    }

    function scan_action( id, action) {
        var xhttp = new XMLHttpRequest();
        xhttp.open( "POST", "/" + action + "/" + id, false);
        xhttp.send();
        if (xhttp.responseText == '') {return;}
        document.getElementById("status" + id).innerHTML = '<span class="changed">' +
                                                           xhttp.responseText +
                                                           '</span>';
        set_collation( id);
    }

    function search_input() {
        setCookie( 'scan_search', document.getElementById( 'search').value);
        load_scan();
    }

    function set_collation( id) {
        var xhttp = new XMLHttpRequest();
        xhttp.open( "GET", "/collation_link/" + id, false);
        xhttp.send();
        document.getElementById("collation" + id).innerHTML = xhttp.responseText;
    }

    document.getElementById( 'search').value = get_cookie( 'scan_search');
    load_scan();
</script>

</body>
</html>